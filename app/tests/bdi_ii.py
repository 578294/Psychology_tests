"""
BDI-II (Шкала депрессии Бека) - 21 вопрос
Оценка выраженности депрессивной симптоматики
Диапазон баллов: 0-63
"""

class BDITest:
    """Класс для работы с тестом BDI-II"""

    def __init__(self):
        self.code = "bdi_ii"
        self.name = "Шкала депрессии Бека (BDI-II)"
        self.description = "Оценка выраженности депрессивной симптоматики"
        self.instructions = "Прочитайте каждое утверждение и выберите тот вариант, который лучше всего описывает ваше состояние за последние 2 недели, включая сегодняшний день."
        self.questions_count = 21
        self.min_score = 0
        self.max_score = 63
        self.time_limit = 10  # минут

    def get_test_data(self) -> dict:
        """Получить данные теста"""
        return {
            "code": self.code,
            "name": self.name,
            "description": self.description,
            "instructions": self.instructions,
            "questions_count": self.questions_count,
            "min_score": self.min_score,
            "max_score": self.max_score,
            "time_limit": self.time_limit,
            "questions": self._get_questions()
        }

    def _get_questions(self) -> list:
        """Получить вопросы теста"""
        return [
            {
                "id": 1,
                "question_number": 1,
                "text": "Чувство печали или подавленности",
                "subscale": "Аффективные симптомы",
                "options": [
                    {"id": 1, "text": "Я не чувствую себя печальным", "value": 0},
                    {"id": 2, "text": "Я чувствую себя печальным", "value": 1},
                    {"id": 3, "text": "Я все время печален и не могу от этого избавиться", "value": 2},
                    {"id": 4, "text": "Я так печален или несчастлив, что не могу этого вынести", "value": 3}
                ]
            },
            {
                "id": 2,
                "question_number": 2,
                "text": "Пессимизм",
                "subscale": "Когнитивные симптомы",
                "options": [
                    {"id": 5, "text": "Я не чувствую разочарования в будущем", "value": 0},
                    {"id": 6, "text": "Я чувствую разочарование в будущем", "value": 1},
                    {"id": 7, "text": "Я чувствую, что мне нечего ждать от будущего", "value": 2},
                    {"id": 8, "text": "Я чувствую, что будущее безнадежно и что ничего не может измениться к лучшему", "value": 3}
                ]
            },
            {
                "id": 3,
                "question_number": 3,
                "text": "Чувство неудачи",
                "subscale": "Когнитивные симптомы",
                "options": [
                    {"id": 9, "text": "Я не чувствую себя неудачником", "value": 0},
                    {"id": 10, "text": "Я чувствую, что потерпел больше неудач, чем другие люди", "value": 1},
                    {"id": 11, "text": "Оглядываясь на свою жизнь, я вижу множество неудач", "value": 2},
                    {"id": 12, "text": "Я чувствую себя полным неудачником как личность", "value": 3}
                ]
            },
            {
                "id": 4,
                "question_number": 4,
                "text": "Удовлетворенность",
                "subscale": "Аффективные симптомы",
                "options": [
                    {"id": 13, "text": "Я получаю столько же удовлетворения от жизни, как и раньше", "value": 0},
                    {"id": 14, "text": "Я не получаю столько удовлетворения от жизни, как раньше", "value": 1},
                    {"id": 15, "text": "Я больше не получаю настоящего удовлетворения от чего бы то ни было", "value": 2},
                    {"id": 16, "text": "Я всем недоволен и всем сыт по горло", "value": 3}
                ]
            },
            {
                "id": 5,
                "question_number": 5,
                "text": "Чувство вины",
                "subscale": "Когнитивные симптомы",
                "options": [
                    {"id": 17, "text": "Я не чувствую себя особенно виноватым", "value": 0},
                    {"id": 18, "text": "Достаточно часто я чувствую себя виноватым", "value": 1},
                    {"id": 19, "text": "Большую часть времени я чувствую себя виноватым", "value": 2},
                    {"id": 20, "text": "Я постоянно чувствую себя виноватым", "value": 3}
                ]
            },
            {
                "id": 6,
                "question_number": 6,
                "text": "Ожидание наказания",
                "subscale": "Когнитивные симптомы",
                "options": [
                    {"id": 21, "text": "Я не чувствую, что буду наказан", "value": 0},
                    {"id": 22, "text": "Я чувствую, что могу быть наказан", "value": 1},
                    {"id": 23, "text": "Я ожидаю наказания", "value": 2},
                    {"id": 24, "text": "Я чувствую, что уже наказан", "value": 3}
                ]
            },
            {
                "id": 7,
                "question_number": 7,
                "text": "Разочарование в себе",
                "subscale": "Самооценка",
                "options": [
                    {"id": 25, "text": "Я не разочарован в себе", "value": 0},
                    {"id": 26, "text": "Я разочарован в себе", "value": 1},
                    {"id": 27, "text": "Я себе противен", "value": 2},
                    {"id": 28, "text": "Я ненавижу себя", "value": 3}
                ]
            },
            {
                "id": 8,
                "question_number": 8,
                "text": "Самокритика",
                "subscale": "Самооценка",
                "options": [
                    {"id": 29, "text": "Я не виню себя больше обычного", "value": 0},
                    {"id": 30, "text": "Я более самокритичен, чем обычно", "value": 1},
                    {"id": 31, "text": "Я критикую себя за все свои ошибки", "value": 2},
                    {"id": 32, "text": "Я виню себя во всем плохом, что происходит", "value": 3}
                ]
            },
            {
                "id": 9,
                "question_number": 9,
                "text": "Суицидальные мысли",
                "subscale": "Суицидальность",
                "options": [
                    {"id": 33, "text": "У меня нет мыслей о самоубийстве", "value": 0},
                    {"id": 34, "text": "У меня есть мысли о самоубийстве, но я не приведу их в исполнение", "value": 1},
                    {"id": 35, "text": "Я хотел бы покончить с собой", "value": 2},
                    {"id": 36, "text": "Я убил бы себя, если бы представилась возможность", "value": 3}
                ]
            },
            {
                "id": 10,
                "question_number": 10,
                "text": "Плаксивость",
                "subscale": "Аффективные симптомы",
                "options": [
                    {"id": 37, "text": "Я плачу не больше, чем обычно", "value": 0},
                    {"id": 38, "text": "Сейчас я плачу чаще, чем раньше", "value": 1},
                    {"id": 39, "text": "Теперь я плачу все время", "value": 2},
                    {"id": 40, "text": "Раньше я мог плакать, а теперь не могу, даже если хочу", "value": 3}
                ]
            },
            {
                "id": 11,
                "question_number": 11,
                "text": "Раздражительность",
                "subscale": "Аффективные симптомы",
                "options": [
                    {"id": 41, "text": "Сейчас я раздражителен не более, чем обычно", "value": 0},
                    {"id": 42, "text": "Я более легко раздражаюсь, чем раньше", "value": 1},
                    {"id": 43, "text": "Теперь я постоянно чувствую раздражение", "value": 2},
                    {"id": 44, "text": "Меня уже ничто не раздражает", "value": 3}
                ]
            },
            {
                "id": 12,
                "question_number": 12,
                "text": "Потеря интереса к людям",
                "subscale": "Социальная изоляция",
                "options": [
                    {"id": 45, "text": "Я не потерял интереса к другим людям", "value": 0},
                    {"id": 46, "text": "Я меньше интересуюсь другими людьми, чем раньше", "value": 1},
                    {"id": 47, "text": "Я почти полностью потерял интерес к другим людям", "value": 2},
                    {"id": 48, "text": "Я полностью потерял интерес к другим людям", "value": 3}
                ]
            },
            {
                "id": 13,
                "question_number": 13,
                "text": "Нерешительность",
                "subscale": "Когнитивные симптомы",
                "options": [
                    {"id": 49, "text": "Я принимаю решения так же легко, как и всегда", "value": 0},
                    {"id": 50, "text": "Я стараюсь отложить принятие решений", "value": 1},
                    {"id": 51, "text": "Мне очень трудно принимать решения", "value": 2},
                    {"id": 52, "text": "Я больше вообще не могу принимать решения", "value": 3}
                ]
            },
            {
                "id": 14,
                "question_number": 14,
                "text": "Представление о себе",
                "subscale": "Самооценка",
                "options": [
                    {"id": 53, "text": "Я не чувствую, что выгляжу хуже, чем обычно", "value": 0},
                    {"id": 54, "text": "Меня беспокоит, что я выгляжу старым и непривлекательным", "value": 1},
                    {"id": 55, "text": "Я чувствую, что в моей внешности произошли постоянные изменения, делающие меня непривлекательным", "value": 2},
                    {"id": 56, "text": "Я уверен, что выгляжу безобразно", "value": 3}
                ]
            },
            {
                "id": 15,
                "question_number": 15,
                "text": "Работоспособность",
                "subscale": "Соматические симптомы",
                "options": [
                    {"id": 57, "text": "Я могу работать так же хорошо, как и раньше", "value": 0},
                    {"id": 58, "text": "Мне нужно прилагать дополнительные усилия, чтобы что-то начать делать", "value": 1},
                    {"id": 59, "text": "Я с большим трудом заставляю себя делать что-либо", "value": 2},
                    {"id": 60, "text": "Я совсем не могу выполнять никакую работу", "value": 3}
                ]
            },
            {
                "id": 16,
                "question_number": 16,
                "text": "Нарушения сна",
                "subscale": "Соматические симптомы",
                "options": [
                    {"id": 61, "text": "Я сплю так же хорошо, как и раньше", "value": 0},
                    {"id": 62, "text": "Сейчас я сплю хуже, чем раньше", "value": 1},
                    {"id": 63, "text": "Я просыпаюсь на 1-2 часа раньше, и мне трудно заснуть снова", "value": 2},
                    {"id": 64, "text": "Я просыпаюсь на несколько часов раньше обычного и не могу заснуть снова", "value": 3}
                ]
            },
            {
                "id": 17,
                "question_number": 17,
                "text": "Утомляемость",
                "subscale": "Соматические симптомы",
                "options": [
                    {"id": 65, "text": "Я устаю не больше, чем обычно", "value": 0},
                    {"id": 66, "text": "Я устаю быстрее, чем обычно", "value": 1},
                    {"id": 67, "text": "Я устаю почти от всего, что я делаю", "value": 2},
                    {"id": 68, "text": "Я слишком устал, чтобы делать что-либо", "value": 3}
                ]
            },
            {
                "id": 18,
                "question_number": 18,
                "text": "Снижение аппетита",
                "subscale": "Соматические симптомы",
                "options": [
                    {"id": 69, "text": "Мой аппетит не хуже, чем обычно", "value": 0},
                    {"id": 70, "text": "Мой аппетит не так хорош, как бывало", "value": 1},
                    {"id": 71, "text": "Мой аппетит стал намного хуже", "value": 2},
                    {"id": 72, "text": "У меня вообще нет аппетита", "value": 3}
                ]
            },
            {
                "id": 19,
                "question_number": 19,
                "text": "Потеря веса",
                "subscale": "Соматические симптомы",
                "options": [
                    {"id": 73, "text": "В последнее время я не потерял в весе", "value": 0},
                    {"id": 74, "text": "Я потерял более 2 кг", "value": 1},
                    {"id": 75, "text": "Я потерял более 4 кг", "value": 2},
                    {"id": 76, "text": "Я потерял более 6 кг", "value": 3}
                ]
            },
            {
                "id": 20,
                "question_number": 20,
                "text": "Озабоченность здоровьем",
                "subscale": "Соматические симптомы",
                "options": [
                    {"id": 77, "text": "Я не больше, чем обычно, озабочен своим здоровьем", "value": 0},
                    {"id": 78, "text": "Меня тревожат проблемы моего здоровья, такие как боли, расстройства желудка, запоры и т.д.", "value": 1},
                    {"id": 79, "text": "Я очень обеспокоен своим физическим состоянием, и мне трудно думать о чем-либо другом", "value": 2},
                    {"id": 80, "text": "Я настолько обеспокоен своим физическим состоянием, что вообще ни о чем другом думать не могу", "value": 3}
                ]
            },
            {
                "id": 21,
                "question_number": 21,
                "text": "Снижение интереса к сексу",
                "subscale": "Соматические симптомы",
                "options": [
                    {"id": 81, "text": "В последнее время я не замечал изменения своего интереса к сексу", "value": 0},
                    {"id": 82, "text": "Меня меньше интересует секс, чем раньше", "value": 1},
                    {"id": 83, "text": "Сейчас мой интерес к сексу значительно меньше", "value": 2},
                    {"id": 84, "text": "Я полностью потерял интерес к сексу", "value": 3}
                ]
            }
        ]

    def calculate(self, answers: list) -> dict:
        """Рассчитать результаты теста"""
        total_score = sum(answer.get("value", 0) for answer in answers)

        # Определение уровня депрессии
        if total_score <= 13:
            severity = "Минимальная депрессия"
            interpretation = "Симптомы депрессии отсутствуют или минимальны. Это нормальный уровень депрессивных симптомов."
        elif total_score <= 19:
            severity = "Легкая депрессия"
            interpretation = "Наблюдаются легкие симптомы депрессии. Могут присутствовать эпизодические симптомы подавленного настроения."
        elif total_score <= 28:
            severity = "Умеренная депрессия"
            interpretation = "Умеренно выраженные симптомы депрессии. Рекомендуется профессиональная помощь."
        else:
            severity = "Тяжелая депрессия"
            interpretation = "Выраженные симптомы депрессии, требующие срочного внимания специалиста."

        recommendations = self._get_recommendations(total_score)

        return {
            "total_score": total_score,
            "severity_level": severity,
            "interpretation": interpretation,
            "recommendations": recommendations,
            "percentile": min(100, int((total_score / self.max_score) * 100))
        }

    def _get_recommendations(self, score: int) -> list:
        if score <= 13:
            return [
                "Продолжайте вести здоровый образ жизни",
                "Регулярные физические упражнения (30 минут в день)",
                "Сбалансированное питание и достаточный сон (7-8 часов)",
                "Поддерживайте социальные связи"
            ]
        elif score <= 19:
            return [
                "Консультация психолога или психотерапевта",
                "Практика техник релаксации и mindfulness",
                "Регулярная физическая активность",
                "Поддержание социальных контактов",
                "Соблюдение режима дня"
            ]
        elif score <= 28:
            return [
                "Консультация врача-психиатра",
                "Рассмотреть возможность психотерапии",
                "Регулярный мониторинг состояния",
                "Обратиться за поддержкой к близким",
                "Избегать употребления алкоголя и наркотиков"
            ]
        else:
            return [
                "СРОЧНАЯ КОНСУЛЬТАЦИЯ ВРАЧА-ПСИХИАТРА",
                "Не оставайтесь в одиночестве",
                "Сообщите близким о своем состоянии",
                "Телефон доверия: 8-800-2000-122",
                "Обратитесь в ближайшую поликлинику или больницу",
                "Исключите доступ к потенциально опасным средствам"
            ]