"""
Шкала оценки суицидального риска (Модифицированная шкала Риск-Надежда)
18 вопросов, диапазон баллов: 0-54
"""

class SuicideRiskTest:
    """Класс для работы с тестом оценки суицидального риска"""

    def __init__(self):
        self.code = "suicide_risk"
        self.name = "Шкала оценки суицидального риска"
        self.description = "Выявление суицидального риска и оценка факторов, способствующих суицидальному поведению"
        self.instructions = "Прочитайте каждое утверждение и выберите наиболее подходящий ответ, описывающий ваше состояние за последний месяц."
        self.questions_count = 18
        self.min_score = 0
        self.max_score = 54
        self.time_limit = 8  # минут

    def get_test_data(self) -> dict:
        """Получить данные теста"""
        return {
            "code": self.code,
            "name": self.name,
            "description": self.description,
            "instructions": self.instructions,
            "questions_count": self.questions_count,
            "min_score": self.min_score,
            "max_score": self.max_score,
            "time_limit": self.time_limit,
            "questions": self._get_questions()
        }

    def _get_questions(self) -> list:
        """Получить вопросы теста"""
        return [
            {
                "id": 1,
                "question_number": 1,
                "text": "В течение последнего месяца у меня были мысли о самоубийстве",
                "subscale": "Суицидальные мысли",
                "options": [
                    {"id": 1, "text": "Никогда", "value": 0},
                    {"id": 2, "text": "Редко (1-2 раза)", "value": 1},
                    {"id": 3, "text": "Иногда (3-5 раз)", "value": 2},
                    {"id": 4, "text": "Часто (более 5 раз)", "value": 3}
                ]
            },
            {
                "id": 2,
                "question_number": 2,
                "text": "У меня есть план совершения самоубийства",
                "subscale": "Суицидальные намерения",
                "options": [
                    {"id": 5, "text": "Нет", "value": 0},
                    {"id": 6, "text": "Есть общие мысли, но нет плана", "value": 1},
                    {"id": 7, "text": "Есть примерный план", "value": 2},
                    {"id": 8, "text": "Есть конкретный детальный план", "value": 3}
                ]
            },
            {
                "id": 3,
                "question_number": 3,
                "text": "Я чувствую себя обузой для других",
                "subscale": "Чувство обузы",
                "options": [
                    {"id": 9, "text": "Нет, не чувствую", "value": 0},
                    {"id": 10, "text": "Иногда возникает такое чувство", "value": 1},
                    {"id": 11, "text": "Часто чувствую себя обузой", "value": 2},
                    {"id": 12, "text": "Постоянно чувствую себя обузой", "value": 3}
                ]
            },
            {
                "id": 4,
                "question_number": 4,
                "text": "У меня нет надежды на улучшение ситуации",
                "subscale": "Безнадежность",
                "options": [
                    {"id": 13, "text": "Есть надежда на улучшение", "value": 0},
                    {"id": 14, "text": "Надежда небольшая", "value": 1},
                    {"id": 15, "text": "Почти нет надежды", "value": 2},
                    {"id": 16, "text": "Полностью отсутствует надежда", "value": 3}
                ]
            },
            {
                "id": 5,
                "question_number": 5,
                "text": "Я чувствую себя одиноким",
                "subscale": "Одиночество",
                "options": [
                    {"id": 17, "text": "Не чувствую одиночества", "value": 0},
                    {"id": 18, "text": "Иногда чувствую себя одиноким", "value": 1},
                    {"id": 19, "text": "Часто чувствую себя одиноким", "value": 2},
                    {"id": 20, "text": "Постоянно чувствую себя одиноким", "value": 3}
                ]
            },
            {
                "id": 6,
                "question_number": 6,
                "text": "У меня нет причин жить",
                "subscale": "Отсутствие смысла жизни",
                "options": [
                    {"id": 21, "text": "Есть много причин жить", "value": 0},
                    {"id": 22, "text": "Есть некоторые причины", "value": 1},
                    {"id": 23, "text": "Мало причин жить", "value": 2},
                    {"id": 24, "text": "Нет никаких причин жить", "value": 3}
                ]
            },
            {
                "id": 7,
                "question_number": 7,
                "text": "Я испытываю сильную душевную боль",
                "subscale": "Психологическая боль",
                "options": [
                    {"id": 25, "text": "Не испытываю душевной боли", "value": 0},
                    {"id": 26, "text": "Иногда испытываю боль", "value": 1},
                    {"id": 27, "text": "Часто испытываю сильную боль", "value": 2},
                    {"id": 28, "text": "Постоянно испытываю невыносимую боль", "value": 3}
                ]
            },
            {
                "id": 8,
                "question_number": 8,
                "text": "У меня есть доступ к средствам для самоубийства",
                "subscale": "Доступность средств",
                "options": [
                    {"id": 29, "text": "Нет доступа", "value": 0},
                    {"id": 30, "text": "Есть ограниченный доступ", "value": 1},
                    {"id": 31, "text": "Есть легкий доступ", "value": 2},
                    {"id": 32, "text": "Есть немедленный доступ", "value": 3}
                ]
            },
            {
                "id": 9,
                "question_number": 9,
                "text": "В прошлом у меня были попытки самоубийства",
                "subscale": "Предыдущие попытки",
                "options": [
                    {"id": 33, "text": "Никогда не было", "value": 0},
                    {"id": 34, "text": "Была 1 попытка", "value": 1},
                    {"id": 35, "text": "Было 2-3 попытки", "value": 2},
                    {"id": 36, "text": "Было более 3 попыток", "value": 3}
                ]
            },
            {
                "id": 10,
                "question_number": 10,
                "text": "В моей семье были случаи самоубийств",
                "subscale": "Семейный анамнез",
                "options": [
                    {"id": 37, "text": "Не было", "value": 0},
                    {"id": 38, "text": "Был 1 случай", "value": 1},
                    {"id": 39, "text": "Было 2-3 случая", "value": 2},
                    {"id": 40, "text": "Было более 3 случаев", "value": 3}
                ]
            },
            {
                "id": 11,
                "question_number": 11,
                "text": "Я злоупотребляю алкоголем или наркотиками",
                "subscale": "Злоупотребление ПАВ",
                "options": [
                    {"id": 41, "text": "Не употребляю", "value": 0},
                    {"id": 42, "text": "Употребляю редко", "value": 1},
                    {"id": 43, "text": "Употребляю регулярно", "value": 2},
                    {"id": 44, "text": "Имею зависимость", "value": 3}
                ]
            },
            {
                "id": 12,
                "question_number": 12,
                "text": "У меня есть психиатрический диагноз",
                "subscale": "Психиатрические заболевания",
                "options": [
                    {"id": 45, "text": "Нет диагноза", "value": 0},
                    {"id": 46, "text": "Был в прошлом", "value": 1},
                    {"id": 47, "text": "Есть текущий диагноз", "value": 2},
                    {"id": 48, "text": "Есть несколько диагнозов", "value": 3}
                ]
            },
            {
                "id": 13,
                "question_number": 13,
                "text": "Я переживаю тяжелый стресс",
                "subscale": "Стрессовые события",
                "options": [
                    {"id": 49, "text": "Нет стресса", "value": 0},
                    {"id": 50, "text": "Умеренный стресс", "value": 1},
                    {"id": 51, "text": "Сильный стресс", "value": 2},
                    {"id": 52, "text": "Очень сильный стресс", "value": 3}
                ]
            },
            {
                "id": 14,
                "question_number": 14,
                "text": "У меня нет поддержки близких",
                "subscale": "Социальная поддержка",
                "options": [
                    {"id": 53, "text": "Есть хорошая поддержка", "value": 0},
                    {"id": 54, "text": "Есть ограниченная поддержка", "value": 1},
                    {"id": 55, "text": "Почти нет поддержки", "value": 2},
                    {"id": 56, "text": "Полностью отсутствует поддержка", "value": 3}
                ]
            },
            {
                "id": 15,
                "question_number": 15,
                "text": "Я чувствую себя в ловушке",
                "subscale": "Чувство ловушки",
                "options": [
                    {"id": 57, "text": "Не чувствую", "value": 0},
                    {"id": 58, "text": "Иногда чувствую", "value": 1},
                    {"id": 59, "text": "Часто чувствую", "value": 2},
                    {"id": 60, "text": "Постоянно чувствую", "value": 3}
                ]
            },
            {
                "id": 16,
                "question_number": 16,
                "text": "У меня нет планов на будущее",
                "subscale": "Отсутствие перспектив",
                "options": [
                    {"id": 61, "text": "Есть планы", "value": 0},
                    {"id": 62, "text": "Есть некоторые планы", "value": 1},
                    {"id": 63, "text": "Планы неясные", "value": 2},
                    {"id": 64, "text": "Нет никаких планов", "value": 3}
                ]
            },
            {
                "id": 17,
                "question_number": 17,
                "text": "Я считаю, что смерть - это избавление",
                "subscale": "Восприятие смерти",
                "options": [
                    {"id": 65, "text": "Не считаю", "value": 0},
                    {"id": 66, "text": "Иногда так кажется", "value": 1},
                    {"id": 67, "text": "Часто так думаю", "value": 2},
                    {"id": 68, "text": "Убежден в этом", "value": 3}
                ]
            },
            {
                "id": 18,
                "question_number": 18,
                "text": "Я написал прощальное письмо или составил завещание",
                "subscale": "Подготовка",
                "options": [
                    {"id": 69, "text": "Нет", "value": 0},
                    {"id": 70, "text": "Думал об этом", "value": 1},
                    {"id": 71, "text": "Начал подготовку", "value": 2},
                    {"id": 72, "text": "Уже подготовил", "value": 3}
                ]
            }
        ]

    def calculate(self, answers: list) -> dict:
        """Рассчитать результаты теста"""
        total_score = sum(answer.get("value", 0) for answer in answers)

        # Определение уровня риска
        if total_score <= 9:
            risk_level = "Низкий риск"
            interpretation = "Суицидальный риск минимален. Ситуация находится под контролем."
        elif total_score <= 18:
            risk_level = "Умеренный риск"
            interpretation = "Наличие суицидальных мыслей требует внимания. Рекомендуется профессиональная помощь."
        elif total_score <= 27:
            risk_level = "Высокий риск"
            interpretation = "Высокий риск суицидального поведения. Требуется немедленная помощь."
        else:
            risk_level = "Очень высокий риск"
            interpretation = "Критический уровень риска. Необходима срочная медицинская помощь."

        recommendations = self._get_recommendations(total_score)

        return {
            "total_score": total_score,
            "risk_level": risk_level,
            "interpretation": interpretation,
            "recommendations": recommendations,
            "emergency": total_score > 18
        }

    def _get_recommendations(self, score: int) -> list:
        if score <= 9:
            return [
                "Продолжайте заботиться о своем психическом здоровье",
                "Регулярная физическая активность",
                "Поддерживайте социальные связи",
                "Обращайтесь за помощью при ухудшении состояния"
            ]
        elif score <= 18:
            return [
                "Запишитесь на консультацию к психологу или психиатру",
                "Обратитесь за поддержкой к близким",
                "Избегайте употребления алкоголя",
                "Регулярно общайтесь с поддерживающими людьми",
                "Уберите потенциально опасные предметы из дома"
            ]
        elif score <= 27:
            return [
                "НЕМЕДЛЕННО обратитесь к врачу-психиатру",
                "Сообщите близким о своем состоянии",
                "Не оставайтесь в одиночестве",
                "Телефон доверия: 8-800-2000-122",
                "Обратитесь в скорую психиатрическую помощь"
            ]
        else:
            return [
                "СРОЧНАЯ МЕДИЦИНСКАЯ ПОМОЩЬ!",
                "Вызовите скорую помощь (103)",
                "Телефон доверия: 8-800-2000-122",
                "Не оставайтесь одни - позовите кого-то",
                "Уберите все опасные предметы",
                "Обратитесь в ближайшую больницу"
            ]